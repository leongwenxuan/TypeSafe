; TypeSafe Flower (Celery Monitoring) - Supervisor Configuration
; 
; Installation:
;   1. Copy to: /etc/supervisor/conf.d/typesafe-flower.conf
;   2. Update paths and credentials
;   3. Run: sudo supervisorctl reread && sudo supervisorctl update
;   4. Start: sudo supervisorctl start typesafe-flower

[program:typesafe-flower]
; Command to run
command=/opt/typesafe/backend/venv/bin/celery -A app.agents.worker flower --port=5555 --broker=redis://localhost:6379/0 --basic_auth=admin:changeme

; Directory to run from
directory=/opt/typesafe/backend

; User to run as
user=typesafe

; Number of processes
numprocs=1

; Auto-start on supervisor start
autostart=true

; Auto-restart on crash
autorestart=true

; Graceful shutdown
stopsignal=TERM
stopwaitsecs=30
stopasgroup=true
killasgroup=true

; Priority
priority=998

; Redirect output to log files
redirect_stderr=true
stdout_logfile=/var/log/typesafe/flower.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=10
stderr_logfile=/var/log/typesafe/flower-error.log
stderr_logfile_maxbytes=50MB
stderr_logfile_backups=10

; Environment variables
environment=
    PATH="/opt/typesafe/backend/venv/bin:/usr/local/bin:/usr/bin:/bin",
    PYTHONPATH="/opt/typesafe/backend",
    CELERY_BROKER_URL="redis://localhost:6379/0",
    CELERY_RESULT_BACKEND="redis://localhost:6379/1"

